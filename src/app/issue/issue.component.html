<app-page-header></app-page-header>

<div class="layout">
  <app-sidebar></app-sidebar>
  <div class="content">
    <div class="card">
      <div class="card-header">
        <h2>Issue</h2>
        <button class="btn-add" (click)="openAddForm()">+ Add New</button>
      </div>

      <div class="table-container">
        <table class="table">
          <thead>
          <tr>
            <th>Task Name</th>
            <th>Issue Title</th>
            <th>Issue Description</th>
            <th>Action Owner</th>
            <th>Priority</th>
            <th>status</th>
            <th>Action</th>
          </tr>
          </thead>
          <tbody>
          <tr *ngFor="let issue of issues">
            <td>{{ issue.taskId }}</td>
            <td>{{issue.issuetitle}}</td>
            <td>{{issue.issuedescription}}</td>
            <td>{{issue.actionOwner}}</td>
            <td [ngStyle]="{
                'color': issue.priority === 'High' ? 'red' :
                 issue.priority === 'Medium' ? 'orange' :
                 issue.priority === 'Low' ? 'green' : 'black'
            }">
              {{ issue.priority || 'â€”' }}
            </td>
            <td>{{issue.status}}</td>
            <td>
              <button class="btn-edit" (click)="editUser(issue)">Edit</button>
              <button class="btn-delete" (click)="openDeletePopup(issue)">Delete</button>
            </td>
          </tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- Add New User Unit Form -->
    <div class="modal" *ngIf="showForm">
      <div class="modal-content">
        <h3>{{ editMode ? 'Edit Issue' : 'Add New Issue' }}</h3>
        <form (ngSubmit)="saveIssue()">

          <label>Task Name:</label>
          <ng-select class="ngitem"
                     [(ngModel)]="newIssue.taskId"
                     [items]="taskList"
                     name="taskTitle"
                     bindLabel="taskTitle"
                     bindValue="taskTitle"
                     [searchable]="true"
          ></ng-select>

          <label>Issue Title:</label>
          <input type="text" [(ngModel)]="newIssue.issuetitle" name="title" required>

          <label>Issue Description:</label>
          <input type="text" [(ngModel)]="newIssue.issuedescription" name="description" required>

          <label>Action Owner:</label>
          <ng-select class="ngitem"
                     [(ngModel)]="newIssue.actionOwner"
                     [items]="userList"
                     name="projectManager"
                     bindLabel="fullname"
                     bindValue="fullname"
                     [searchable]="true"
          >
          </ng-select>

          <label>Priority:</label>
          <select [(ngModel)]="newIssue.priority" name="priority" class="form-select">
            <option [ngValue]="null"> Select Priority </option>
            <option value="High">High</option>
            <option value="Medium">Medium</option>
            <option value="Low">Low</option>
          </select>

          <label>Status:</label>
          <select [(ngModel)]="newIssue.status" name="staus" class="form-select">
            <option [ngValue]="null"> Select status</option>
            <option value="Open">Open</option>
            <option value="In progress">In progress</option>
            <option value="Resolved">Resolved</option>
            <option value="Closed">Closed</option>
          </select>

          <div class="form-buttons">
            <button type="submit" class="btn-save">
              {{ editMode ? 'Update' : 'Save' }}
            </button>
            <button type="button" class="btn-cancel" (click)="cancel()">Cancel</button>
          </div>
        </form>
      </div>
    </div>

    <div class="modal" *ngIf="showDeletePopup">
      <div class="modal-content">
        <h3>Delete Business Unit</h3>
        <p>Are you sure you want to delete <strong>{{ selectedIssue?.id }}</strong>?</p>
        <div class="form-buttons">
          <button class="btn-delete" (click)="confirmDelete()">Yes, Delete</button>
          <button class="btn-cancel" (click)="cancelDelete()">Cancel</button>
        </div>
      </div>
    </div>
  </div>
</div>
