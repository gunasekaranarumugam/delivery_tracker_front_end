<app-page-header></app-page-header>

<div class="layout">
  <app-sidebar></app-sidebar>
  <div class="content">
    <div class="card">
      <div class="card-header">
        <h2>Deliverable</h2>
        <button class="btn-add" (click)="openAddForm()">+ Add New</button>
      </div>

      <div class="table-container">
        <table class="table">
          <thead>
          <tr>
            <th>Project Name</th>
            <th>Title</th>
            <th>Description</th>
            <th>Priority</th>
            <th>Planned to Start</th>
            <th>Planned to End</th>
            <th>Action</th>
          </tr>
          </thead>
          <tbody>
          <tr *ngFor="let deliverable of deliverables">
            <td>{{ deliverable.projectId }}</td>
            <td>{{deliverable.title}}</td>
            <td>{{deliverable.description}}</td>
            <td [ngStyle]="{
                'color': deliverable.priority === 'High' ? 'red' :
                 deliverable.priority === 'Medium' ? 'orange' :
                 deliverable.priority === 'Low' ? 'green' : 'black'
            }">
              {{ deliverable.priority || 'â€”' }}
            </td>
            <td>{{ deliverable.plannedStartDate }}</td>
            <td>{{ deliverable.plannedEndDate }}</td>
            <td>
              <button class="btn-edit" (click)="editUser(deliverable)">Edit</button>
              <button class="btn-delete" (click)="openDeletePopup(deliverable)">Delete</button>
            </td>
          </tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- Add New User Unit Form -->
    <div class="modal" *ngIf="showForm">
      <div class="modal-content">
        <h3>{{ editMode ? 'Edit Deliverable' : 'Add New Deliverable' }}</h3>
        <form (ngSubmit)="saveDeliverable()">

          <label>Project Name:</label>
          <ng-select class="ngitem"
                     [(ngModel)]="newDeliverable.projectId"
                     [items]="projectList"
                     name="projectId"
                     bindLabel="name"
                     bindValue="name"
                     [searchable]="true"
          ></ng-select>

          <label>Title:</label>
          <input type="text" [(ngModel)]="newDeliverable.title" name="title" required>

          <label>Description:</label>
          <input type="text" [(ngModel)]="newDeliverable.description" name="description" required>

          <label>Priority:</label>
          <select [(ngModel)]="newDeliverable.priority" name="priority" class="form-select">
            <option [ngValue]="null"> Select Priority </option>
            <option value="High">High</option>
            <option value="Medium">Medium</option>
            <option value="Low">Low</option>
          </select>


          <!--          <label>Delivery Manager:</label>-->
<!--          <ng-select class="ngitem"-->
<!--                     [(ngModel)]="newProject.projectManager"-->
<!--                     [items]="userList"-->
<!--                     name="projectManager"-->
<!--                     bindLabel="fullname"-->
<!--                     bindValue="fullname"-->
<!--                     [searchable]="true"-->
<!--          >-->
<!--          </ng-select>-->

          <!--          <label>Baseline start date:</label>-->
          <!--          <input type="date" [(ngModel)]="newProject.baselinestart" name="baselinestartdate" required >-->

          <!--          <label>Baseline End date:</label>-->
          <!--          <input type="date" [(ngModel)]="newProject.baselineend" name="baselineenddate" required >-->

          <label>Plan Start Date:</label>
          <input type="date" [(ngModel)]="newDeliverable.plannedStartDate" name="plantostartdate" required >

          <label>Plan End Date:</label>
          <input type="date" [(ngModel)]="newDeliverable.plannedEndDate" name="plantoenddate" required>

          <div class="form-buttons">
            <button type="submit" class="btn-save">
              {{ editMode ? 'Update' : 'Save' }}
            </button>
            <button type="button" class="btn-cancel" (click)="cancel()">Cancel</button>
          </div>
        </form>
      </div>
    </div>

    <div class="modal" *ngIf="showDeletePopup">
      <div class="modal-content">
        <h3>Delete Deliverable</h3>
        <p>Are you sure you want to delete <strong>{{ selectedDeliverable?.title }}</strong>?</p>
        <div class="form-buttons">
          <button class="btn-delete" (click)="confirmDelete()">Yes, Delete</button>
          <button class="btn-cancel" (click)="cancelDelete()">Cancel</button>
        </div>
      </div>
    </div>
  </div>
</div>
